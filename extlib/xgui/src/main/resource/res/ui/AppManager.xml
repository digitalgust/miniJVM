<table name="ROOT_PAN" h="100%" w="100%" oninit="onload()">
    <script>
        <![CDATA[
        sub onload() '这个用来获取服务器上的策略网址信息

            if(!isDef("ENCRYPTED_KEY"))
                def("ENCRYPTED_KEY","L7%d9&3jw5f")
            ret
            if(isDef("INITED"))
                ret
            eif

            ret

            policyUrl=getEnv("POLICY_URL")
            if(strlen(policyUrl)>0)
                url=policyUrl + "?ver=" + getEnv("CVER") + "&sver=" + getEnv("SVER")
                httpRequest(policyUrl, "ROOT_PAN.onPolicyRequestBack")
            eif
        ret

        sub onCallBack(url,code,msg) '通用回调
            showMsg("{Message}: "+msg)
        ret

        sub onPolicyRequestBack(url,code,msg) '请求策略回调
            if(code=0)
                def("INITED",1)
                urls=split(msg,"\n")
                setEnv("DISCOVERY_URL",urls[0])
                setEnv("ACCOUNT_BASE_URL",urls[1])
            eif
        ret

        sub showDiscovery() '显示发现
            showSlot("SLOT_MGR", 3)
            url=getEnv("DISCOVERY_URL")+"?ver="+ getEnv("SVER")  +"&cver="+ getEnv("CVER") +"&cver="+ getEnv("CVER") +"&from="+ getEnv("FROM") +"&jar="+ getEnv("JAR") +"&lang="+ getEnv("LANG")
            openPage(url,"")
        ret

        sub showMy() '显示我的
            showSlot("SLOT_MGR", 4)
            str=getText("LOGIN_UID")
            if(strlen(str)<>0)
                ret
            eif
            uid=getEnv("USERNAME")
            pwd=getEnv("USERPASS")
            if(strlen(uid)=0 | strlen(pwd)=0)
                ret
            eif
            pwd=decrypt(pwd,ENCRYPTED_KEY)
            setText("LOGIN_UID", uid)
            setText("LOGIN_PWD", pwd)
        ret

        sub signup() '注册
            sUid=getText("SIGNUP_UID")
            sPwd=getText("SIGNUP_PWD")
            if(strlen(sUid)=0 | strlen(sPwd)=0)
                showMsg("{Account or password can not be empty}")
            else
                accBaseUrl=getEnv("ACCOUNT_BASE_URL")
                encryptPwd=encrypt(sPwd,ENCRYPTED_KEY)
                url=accBaseUrl + "/register?usr=" + sUid + "&pwd=" + encryptPwd +"&ver="+ getEnv("SVER") +"&cver="+ getEnv("CVER") +"&from="+ getEnv("FROM") +"&jar="+ getEnv("JAR") +"&lang="+ getEnv("LANG")
                println(url)
                httpRequest(url,"ROOT_PAN.onSignUpBack")
                setText("LOGIN_VERIFY_UID", sUid)
            eif
        ret

        sub onSignUpBack(url,code,msg) '注册回调
            if(code=0)
                showMsg("{Message}: "+msg)
            else
                showMsg("{Message}: "+msg)
            eif
        ret


        sub verifyCode() '验证码
            sUid=getText("LOGIN_VERIFY_UID")
            code=getText("LOGIN_VERIFY_CODE")
            if(strlen(sUid)=0 | strlen(code)=0)
                showMsg("{Account or code can not be empty}")
            else
                accBaseUrl=getEnv("ACCOUNT_BASE_URL")
                url=accBaseUrl + "/verifyreg?usr=" + sUid + "&code=" + code +"&ver="+ getEnv("SVER") +"&cver="+ getEnv("CVER") +"&from="+ getEnv("FROM") +"&jar="+ getEnv("JAR") +"&lang="+ getEnv("LANG")
                httpRequest(url,"ROOT_PAN.onVerifyRegBack")
            eif
        ret


        sub onVerifyRegBack(url,code,msg) '验证码回调
            if(code=0)
                showMsg("{Message}: "+msg)
            else
                showMsg("{Message}: "+msg)
            eif
        ret

        sub signIn() '登录
            loginUid=getText("LOGIN_UID")
            loginPwd=getText("LOGIN_PWD")

            if(strlen(loginUid)=0 | strlen(loginPwd)=0)
                showMsg("{Account or password can not be empty}")
            else
                encryptPwd=encrypt(loginPwd,ENCRYPTED_KEY)
                println(encryptPwd)

                accBaseUrl=getEnv("ACCOUNT_BASE_URL")
                url=accBaseUrl + "/login?usr=" + loginUid + "&pwd=" + encryptPwd  +"&ver="+ getEnv("SVER") +"&cver="+ getEnv("CVER") +"&from="+ getEnv("FROM") +"&jar="+ getEnv("JAR") +"&lang="+ getEnv("LANG")
                httpRequest(url,"ROOT_PAN.onSignInBack")
                saveEnable=getSwitch("LOGIN_SAVE")
                if(saveEnable)
                    setEnv("USERNAME", loginUid)
                    setEnv("USERPASS", encryptPwd)
                else
                    setEnv("USERNAME", "")
                    setEnv("USERPASS", "")
                eif
            eif
        ret

        sub onSignInBack(url,code,msg) '登录回调
            if(code=0)
                showMsg("{Message}: {Success}")
                setEnv("TOKEN", msg)
                uid=getEnv("USERNAME")
                setText("LAB_USERNAME", uid)
                setText("LOGIN_VERIFY_UID", uid)
            else
                showMsg("{Message}: {Fail}")
            eif
        ret

        sub retrievePwd() '找回密码发送验证码
            sUid=getText("LOGIN_FORGOT_UID_PRE")
            if(strlen(sUid)=0)
                showMsg("{Account can not be empty}")
            else
                accBaseUrl=getEnv("ACCOUNT_BASE_URL")
                url=accBaseUrl + "/retrieve?usr=" + sUid +"&ver="+ getEnv("SVER") +"&cver="+ getEnv("CVER") +"&from="+ getEnv("FROM") +"&jar="+ getEnv("JAR") +"&lang="+ getEnv("LANG")
                println(url)
                httpRequest(url,"ROOT_PAN.onCallBack")
                setText("LOGIN_FORGOT_UID", sUid)
            eif
        ret

        sub retrieveChgPwd() '收到验证码后更改密码
            sUid=getText("LOGIN_FORGOT_UID")
            sCode=getText("LOGIN_FORGOT_CODE")
            sPwd=getText("LOGIN_FORGOT_PWD")
            if(strlen(sUid)=0 | strlen(sPwd)=0 | strlen(sCode)=0)
                showMsg("{Account or password can not be empty}")
            else
                accBaseUrl=getEnv("ACCOUNT_BASE_URL")
                encryptPwd=encrypt(sPwd,ENCRYPTED_KEY)
                url=accBaseUrl + "/retrievechgpwd?usr=" + sUid + "&pwd=" + encryptPwd + "&code=" + sCode +"&ver="+ getEnv("SVER") +"&cver="+ getEnv("CVER") +"&from="+ getEnv("FROM") +"&jar="+ getEnv("JAR") +"&lang="+ getEnv("LANG")
                println(url)
                httpRequest(url,"ROOT_PAN.onCallBack")
            eif
        ret

        sub changePwd() '输入账号老密码改新密码
            sUid=getText("LOGIN_CHGPWD_UID")
            sOld=getText("LOGIN_CHGPWD_OLD")
            sNew=getText("LOGIN_CHGPWD_NEW")
            if(strlen(sUid)=0 | strlen(sOld)=0 | strlen(sNew)=0)
                showMsg("{Account or password can not be empty}")
            else
                accBaseUrl=getEnv("ACCOUNT_BASE_URL")
                encryptOld=encrypt(sOld,ENCRYPTED_KEY)
                encryptNew=encrypt(sNew,ENCRYPTED_KEY)
                url=accBaseUrl + "/chgpwd?usr=" + sUid + "&pwd=" + encryptPwd + "&code=" + sCode +"&ver="+ getEnv("SVER") +"&cver="+ getEnv("CVER") +"&from="+ getEnv("FROM") +"&jar="+ getEnv("JAR") +"&lang="+ getEnv("LANG")
                println(url)
                httpRequest(url,"ROOT_PAN.onCallBack")
            eif
        ret

        ]]>
    </script>
    <tr h="{STATEBAR_HEIGHT}" w="100%">
        <td>
            <label w="100%"></label>
        </td>
    </tr>
    <tr h="float" w="100%">
        <td w="100%" h="100%">
            <viewslot w="100%" h="100%" scroll="h" name="SLOT_MGR">
                <!-- 0 APPLICATION LIST -->
                <panel name="PAN_MGR" w="100%" h="100%" move="fixed" align="hcenter,top">
                    <table w="98%" h="100%">
                        <tr>
                            <td>
                                <table w="100%">
                                    <tr w="100%">
                                        <td w="float"></td>
                                        <td w="50">
                                            <button name="BT_STYLE" w="50" h="30" preicon="⚙"></button>
                                        </td>
                                    </tr>
                                </table>
                                <!--                                <label w="99%"></label>-->

                                <br/>
                                <label w="100%" h="30" align="hcenter,vcenter">{PLUGIN MANAGER}</label>
                                <input name="INPUT_SEARCH" w="100%" h="30" style="search" hint="Search plugin"></input>
                                <br/>
                            </td>
                        </tr>
                        <tr h="float">
                            <td>
                                <list name="LIST_APP" w="100%" h="100%" multiline="1" itemh="50">
                                </list>
                            </td>
                        </tr>
                    </table>
                </panel>

                <!-- 1 APPLICATION DETAIL -->
                <panel w="100%" h="100%" move="left" align="hcenter,top">
                    <viewport name="VP_CONTENT" w="98%" h="100%">
                        <button name="BT_BACK" h="30" addon="50" preicon="">{Back}</button>
                        <label name="APP_NAME_LABEL" w="100%" h="35" align="hcenter,vcenter"></label>
                        <img name="APP_ICON_ITEM" pic="/res/appmgr.png" w="128" h="128" border="1" fontsize="10"></img>
                        <br/>
                        <br/>
                        <button name="APP_RUN_BTN" w="100%" h="35">{Run}</button>
                        <br/>
                        <button name="APP_STOP_BTN" w="100%" h="35">{Close}</button>
                        <br/>
                        <button name="APP_UPGRADE_BTN" w="100%" h="35">{upgrade}</button>
                        <br/>
                        <button name="APP_DELETE_BTN" w="100%" h="35">{Delete}</button>
                        <input name="APP_DESC_LABEL" multiline="1" edit="0" w="100%" h="150"></input>
                        <br/>
                        <label name="APP_BLANK" w="100%" h="30" align="hcenter,vcenter"></label>
                    </viewport>
                </panel>
                <!-- 2 SETTING -->
                <panel w="100%" h="100%" move="fixed" align="hcenter,top">
                    <viewport name="PAN_SETTING" w="98%" h="100%">
                        <button onclick='showSlot("SLOT_MGR" ,4)' h="30" addon="50" preicon="">{Back}</button>
                        <label w="100%" h="30" align="hcenter,vcenter">{SETTING}</label>
                        <list name="LIST_LANG" w="100%" multiline="0">
                            <li name="LI_ENG">English</li>
                            <li name="LI_CHS">简体中文</li>
                            <li name="LI_CHT">繁體中文</li>
                        </list>
                        <br/>
                        <list name="LIST_STYLE" w="100%" multiline="0">
                            <li name="LI_BRIGHT" selected="1">{Bright appearance}</li>
                            <li name="LI_DARK">{Dark appearance}</li>
                        </list>
                        <label w="100%" h="20"></label>
                        <label w="100%" h="30" align="left,vcenter">{Download plugin from website:}</label>
                        <input name="INPUT_URL" w="75%" h="30" hint="application jar url">
                            https://raw.githubusercontent.com/digitalgust/plugin4minijvm/main/plugins/ExGame.jar
                        </input>
                        <button name="BT_DOWN" w="25%" h="30" preicon="📥">{Download}</button>
                        <label w="100%" h="20"></label>
                        <label w="75%" h="30" align="left,vcenter">{Install plugin from local file:}</label>
                        <button name="BT_LOCALFILE" w="25%" h="30" preicon="📁">{Browse File}</button>
                        <label w="100%" h="20"></label>
                        <label name="LAB_WEBSRV" w="75%" h="30" align="left,vcenter">{Lan webserver for upload plugin}
                        </label>
                        <button name="BT_STARTWEB" w="25%" h="30" preicon="📤">{Start}</button>
                        <label w="100%" h="20"></label>
                        <br/>
                        <input name="INPUT_LOG" w="100%" h="200" edit="0" multiline="1">{Message}</input>
                        <label></label>
                    </viewport>
                </panel>
                <!-- 3 DISCOVERY -->
                <panel w="100%" h="100%" move="fixed" align="hcenter,top">
                    <table w="98%" h="100%">
                        <tr w="100%" h="30">
                            <td w="150" h="100%">
                                <button name="BT_DISCOVERY_BACK" w="50" h="30" preicon="⬅"></button>
                                <button name="BT_DISCOVERY_FORWARD" w="50" h="30" preicon="➡"></button>
                                <button name="BT_DISCOVERY_REFRESH" w="50" h="30" preicon="🔄"></button>
                            </td>
                            <td w="float" h="100%">
                                <label w="100%" h="30" fontsize="20" align="hcenter,vcenter">{DISCOVERY}</label>
                            </td>
                        </tr>
                        <tr w="100%" h="float">
                            <td w="100%" h="100%" name="TD_DISCOVERY">
                            </td>
                        </tr>
                    </table>
                </panel>
                <!-- 4 MY -->
                <panel w="100%" h="100%" move="fixed" align="hcenter,top">
                    <viewport name="PAN_MY" w="98%" h="100%">
                        <label w="100%" h="30" align="hcenter,vcenter">{MY}</label>
                        <br/>
                        <table w="100%">
                            <tr>
                                <td w="80" h="85">
                                    <img w="80" h="80" border="1" pic="/res/ui/head.png"></img>
                                </td>
                                <td w="20"></td>
                                <td w="float" bgcolor="55558020">
                                    <label name="LAB_USERNAME" onclick='showSlot("SLOT_MGR" ,5)' w="100%" h="80" color="bb8844ff" fontsize="18" align="hcenter,vcenter">{Sign in} &gt;</label>
                                </td>
                            </tr>
                        </table>
                        <label></label>
                        <br/>
                        <button name="BT_SETTING" w="100%" h="40" preicon="⚙">{SETTING}</button>
                        <br/>
                        <label></label>
                    </viewport>
                </panel>
                <!-- 5 sing in -->
                <panel w="100%" h="100%" move="fixed" align="hcenter,top">
                    <viewport name="PAN_LOGIN" w="98%" h="100%">
                        <button onclick='showSlot("SLOT_MGR" ,4)' h="30" addon="50" preicon="">{Back}</button>
                        <br/>
                        <panel w="100%" h="5"/>
                        <label w="100%" h="30" align="left,vcenter">{Sign in}</label>
                        <br/>
                        <input w="100%" name="LOGIN_UID" hint="{Account, email or mobile}"></input>
                        <br/>
                        <input w="100%" name="LOGIN_PWD" password="1" hint="{Password}"></input>
                        <switch name="LOGIN_SAVE" selected="1" w="40" h="25"></switch>
                        <label w="100" h="30" align="Left,vcenter">{Remember me}</label>
                        <br/>
                        <button w="100%" onclick="signIn()" preicon="👤">{Sign in}</button>
                        <panel w="100%" h="5"/>
                        <br/>
                        <label></label>
                        <br/>
                        <panel w="100%" h="5"/>
                        <label w="100%" h="30" align="Left,vcenter">{I don't have an account, sign up now}</label>
                        <br/>
                        <button w="100%" onclick='showSlot("SLOT_MGR" ,6)' preicon="">{Sign up}</button>
                        <panel w="100%" h="5"/>
                        <br/>
                        <label></label>
                        <br/>
                        <panel w="100%" h="5"/>
                        <label w="100%" h="30" align="Left,vcenter">{I have an account, But I forgot my password}</label>
                        <br/>
                        <button w="100%" onclick='showSlot("SLOT_MGR" ,7)' preicon="🔓">{Forgot password}</button>
                        <panel w="100%" h="5"/>
                        <br/>
                        <label></label>
                        <br/>
                        <panel w="100%" h="5"/>
                        <label w="100%" h="30" align="Left,vcenter">{I want to change my password}</label>
                        <br/>
                        <button w="100%" onclick='showSlot("SLOT_MGR" ,8)' preicon="🔑">{Change password}</button>
                        <panel w="100%" h="100"/>
                    </viewport>
                </panel>
                <!-- 6 sign up -->
                <panel w="100%" h="100%" move="fixed" align="hcenter,top">
                    <viewport name="PAN_REG" w="98%" h="100%">
                        <button onclick='showSlot("SLOT_MGR" ,5)' h="30" addon="50" preicon="">{Back}</button>
                        <br/>
                        <label w="100%" h="30" align="left,vcenter">{I don't have an account, sign up now}</label>
                        <br/>
                        <input w="100%" name="SIGNUP_UID" hint="{Account, email or mobile}"></input>
                        <br/>
                        <input w="100%" name="SIGNUP_PWD" password="1" hint="{Password},6-32"></input>
                        <br/>
                        <button name="LOGIN_REG" w="100%" onclick="signup()">{Sign up}</button>
                        <br/>
                        <label></label>
                        <br/>
                        <label w="100%" h="50" align="left,vcenter" multiline="1">{After submitting your sign-up information, you will receive an email or SMS verification code.}</label>
                        <br/>
                        <input w="100%" name="LOGIN_VERIFY_UID" hint="{Account, email or mobile}"></input>
                        <br/>
                        <input w="100%" name="LOGIN_VERIFY_CODE" password="0" hint="{Verify Code}"></input>
                        <br/>
                        <button w="100%" onclick="verifyCode()">{Verify Code}</button>

                    </viewport>
                </panel>
                <!-- 7 forgot password -->
                <panel w="100%" h="100%" move="fixed" align="hcenter,top">
                    <viewport name="PAN_REG" w="98%" h="100%">
                        <button onclick='showSlot("SLOT_MGR" ,5)' h="30" addon="50" preicon="">{Back}</button>
                        <br/>
                        <label w="100%" h="30" align="hcenter,vcenter">{Forgot password}</label>
                        <br/>
                        <label>{Input your account: email or mobile}</label>
                        <br/>
                        <input w="100%" name="LOGIN_FORGOT_UID_PRE" hint="{Account, email or mobile}"></input>
                        <br/>
                        <button name="LOGIN_REG" w="100%" onclick="retrievePwd()">{Send code}</button>
                        <br/>
                        <label w="100%" h="50" align="left,vcenter" multiline="1">{After submitting your account, you will receive an email or SMS verification code.}</label>
                        <br/>
                        <input w="100%" name="LOGIN_FORGOT_UID" hint="{Account, email or mobile}"></input>
                        <br/>
                        <input w="100%" name="LOGIN_FORGOT_CODE" password="0" hint="{Verify Code}"></input>
                        <br/>
                        <input w="100%" name="LOGIN_FORGOT_PWD" password="1" hint="{New password}"></input>
                        <br/>
                        <button w="100%" onclick="retrieveChgPwd()">{Change password}</button>

                    </viewport>
                </panel>
                <!-- 8 change password -->
                <panel w="100%" h="100%" move="fixed" align="hcenter,top">
                    <viewport name="PAN_REG" w="98%" h="100%">
                        <button onclick='showSlot("SLOT_MGR" ,5)' h="30" addon="50" preicon="">{Back}</button>
                        <br/>
                        <label w="100%" h="30" align="hcenter,vcenter">{Change password}</label>
                        <br/>
                        <label>{Input your account: email or mobile}</label>
                        <br/>
                        <input w="100%" name="LOGIN_CHGPWD_UID" hint="{Account, email or mobile}"></input>
                        <br/>
                        <input w="100%" name="LOGIN_CHGPWD_OLD" password="1" hint="{Old password}"></input>
                        <br/>
                        <input w="100%" name="LOGIN_CHGPWD_NEW" password="1" hint="{New password}"></input>
                        <br/>
                        <button w="100%" onclick="changePwd()">{Change password}</button>

                    </viewport>
                </panel>
            </viewslot>
        </td>
    </tr>
    <tr h="50" w="100%">
        <td w="100%" h="100%">
            <menu name="MENU_MAIN" w="100%" h="100%">
                <mi name="MI_PLUGINMGR" onclick='showSlot("SLOT_MGR",0)'>{PLUGIN}</mi>
                <mi name="MI_DISCOVERY" onclick="showDiscovery()">{DISCOVERY}</mi>
                <mi name="MI_MY" onclick="showMy()">{MY}</mi>
            </menu>
        </td>
    </tr>
</table>